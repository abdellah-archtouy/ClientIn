<!doctype html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Hello world project</title>

    <!-- ResizeObserver error suppression - must run first -->
    <script>
      (function () {
        "use strict";

        // Comprehensive ResizeObserver error suppression
        const resizeObserverErrorRegex =
          /ResizeObserver loop completed with undelivered notifications/i;

        // Override console methods immediately
        const originalError = console.error;
        const originalWarn = console.warn;

        console.error = function (...args) {
          if (
            args.some(
              (arg) =>
                typeof arg === "string" && resizeObserverErrorRegex.test(arg),
            )
          ) {
            return; // Suppress ResizeObserver errors
          }
          return originalError.apply(console, args);
        };

        console.warn = function (...args) {
          if (
            args.some(
              (arg) =>
                typeof arg === "string" && resizeObserverErrorRegex.test(arg),
            )
          ) {
            return; // Suppress ResizeObserver warnings
          }
          return originalWarn.apply(console, args);
        };

        // Override window.onerror
        window.onerror = function (message, source, lineno, colno, error) {
          if (
            typeof message === "string" &&
            resizeObserverErrorRegex.test(message)
          ) {
            return true; // Prevent default error handling
          }
          return false;
        };

        // Override window error event listener
        window.addEventListener(
          "error",
          function (e) {
            if (resizeObserverErrorRegex.test(e.message)) {
              e.preventDefault();
              e.stopPropagation();
              return false;
            }
          },
          true,
        ); // Use capture phase

        // Override unhandled promise rejections
        window.addEventListener("unhandledrejection", function (e) {
          if (
            e.reason &&
            e.reason.message &&
            resizeObserverErrorRegex.test(e.reason.message)
          ) {
            e.preventDefault();
            return false;
          }
        });

        // Override ResizeObserver constructor when it becomes available
        Object.defineProperty(window, "ResizeObserver", {
          get: function () {
            return this._ResizeObserver;
          },
          set: function (value) {
            this._ResizeObserver = value;
            if (value) {
              // Wrap the original ResizeObserver
              const OriginalResizeObserver = value;
              window._ResizeObserver = class extends OriginalResizeObserver {
                constructor(callback) {
                  const wrappedCallback = function (entries, observer) {
                    try {
                      callback(entries, observer);
                    } catch (error) {
                      if (!resizeObserverErrorRegex.test(error.message || "")) {
                        throw error;
                      }
                      // Silently ignore ResizeObserver loop errors
                    }
                  };
                  super(wrappedCallback);
                }
              };
            }
          },
        });
      })();
    </script>
  </head>

  <body>
    <div id="root"></div>

    <script type="module" src="/client/App.tsx"></script>
  </body>
</html>
